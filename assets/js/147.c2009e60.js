(window.webpackJsonp=window.webpackJsonp||[]).push([[147],{647:function(s,t,a){"use strict";a.r(t);var n=a(6),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"执行流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#执行流程"}},[s._v("#")]),s._v(" 执行流程")]),s._v(" "),a("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://my-blog-leo.oss-cn-chengdu.aliyuncs.com/axios1.png"}}),s._v(" "),a("p",[a("strong",[s._v("整体流程")])]),s._v(" "),a("p",[a("code",[s._v("request(config)")]),s._v(" ==> "),a("code",[s._v("dispatchRequest(config)")]),s._v(" ==> "),a("code",[s._v("xhrAdapter(config)")])]),s._v(" "),a("p",[a("strong",[s._v("request(config)")])]),s._v(" "),a("p",[s._v("将请求拦截器 / "),a("code",[s._v("dispatchRequest()")]),s._v(" / 响应拦截器 通过 "),a("code",[s._v("promise")]),s._v(" 链串连起来, 返回 promise")]),s._v(" "),a("p",[a("strong",[s._v("dispatchRequest(config)")])]),s._v(" "),a("p",[s._v("转换请求数据 ===> 调用 "),a("code",[s._v("xhrAdapter()")]),s._v(" 发请求 ===> 请求返回后转换响应数据. 返回 "),a("code",[s._v("promise")])]),s._v(" "),a("p",[a("strong",[s._v("xhrAdapter(config)")])]),s._v(" "),a("p",[s._v("创建 "),a("code",[s._v("XHR")]),s._v(" 对象, 根据 "),a("code",[s._v("config")]),s._v(" 进行相应设置, 发送特定请求, 并接收响应数据, 返回 "),a("code",[s._v("promise")])]),s._v(" "),a("h2",{attrs:{id:"请求-响应拦截"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#请求-响应拦截"}},[s._v("#")]),s._v(" 请求/响应拦截")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://my-blog-leo.oss-cn-chengdu.aliyuncs.com/axios2.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"请求拦截器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#请求拦截器"}},[s._v("#")]),s._v(" 请求拦截器")]),s._v(" "),a("p",[s._v("在真正发送请求前执行的回调函数，可以对请求进行检查或配置进行特定处理，成功的回调函数，传递的默认是 "),a("code",[s._v("config")]),s._v(" (也必须是)，失败的回调函数, 传递的默认是 "),a("code",[s._v("error")])]),s._v(" "),a("h3",{attrs:{id:"响应拦截器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#响应拦截器"}},[s._v("#")]),s._v(" 响应拦截器")]),s._v(" "),a("p",[s._v("在请求得到响应后执行的回调函数，可以对响应数据进行特定处理，成功的回调函数，传递的默认是 "),a("code",[s._v("response")]),s._v(" 失败的回调函数,传递的默认是 "),a("code",[s._v("error")])]),s._v(" "),a("h2",{attrs:{id:"请求-响应数据转换器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#请求-响应数据转换器"}},[s._v("#")]),s._v(" 请求/响应数据转换器")]),s._v(" "),a("p",[s._v("请求转换器: 对请求头和请求体数据进行特定处理的函数")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("utils"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("isObject")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setContentTypeIfUnset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("headers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'application/json;charset=utf-8'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("JSON")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("stringify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("响应转换器: 将响应体 json 字符串解析为 js 对象或数组的函数")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("JSON")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("parse")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("code",[s._v("response")]),s._v(" 的整体结构")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n  status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n  statusText"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n  headers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n  config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n  request\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[a("code",[s._v("error")]),s._v(" 的整体结构")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n  request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h2",{attrs:{id:"取消请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#取消请求"}},[s._v("#")]),s._v(" 取消请求")]),s._v(" "),a("p",[s._v("当配置了"),a("code",[s._v("cancelToken")]),s._v(" 对象时")]),s._v(" "),a("p",[s._v("保存 "),a("code",[s._v("cancel")]),s._v(" 函数 ，创建一个用于将来中断请求的 "),a("code",[s._v("cancelPromise")]),s._v("，并定义了一个用于取消请求的 "),a("code",[s._v("cancel")]),s._v(" 函数 ，将 "),a("code",[s._v("cancel")]),s._v(" 函数传递出来")]),s._v(" "),a("p",[s._v("调用 "),a("code",[s._v("cancel()")]),s._v(" 取消请求")]),s._v(" "),a("p",[s._v("执行 "),a("code",[s._v("cacel")]),s._v(" 函数, 传入错误信息 "),a("code",[s._v("message")]),s._v("，内部会让 "),a("code",[s._v("cancelPromise")]),s._v(" 变为成功, 且成功的值为一个"),a("code",[s._v("Cancel")]),s._v(" 对象 ，在 "),a("code",[s._v("cancelPromise")]),s._v(" 的成功回调中中断请求, 并让发请求的 "),a("code",[s._v("proimse")]),s._v(" 失败, 失败的 "),a("code",[s._v("reason")]),s._v("为 "),a("code",[s._v("Cacel")]),s._v("对象")])])}),[],!1,null,null,null);t.default=e.exports}}]);
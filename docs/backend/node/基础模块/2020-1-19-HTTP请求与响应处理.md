---
title: "HTTP 请求与响应处理"
date: 2020-01-19
sidebar: 'auto'
categories:
- BackEnd
tags:
- node基础模块
---






# HTTP 请求与响应处理

## 请求参数

> 客户端向服务器端发送请求时，有时需要携带一些客户信息，客户信息需要通过请求参数的形式传递到服务器端，比如登录操作。



### GET请求参数

* 参数被放在浏览器地址栏中，`?name = cisnci & aeg=19 `以`？`开始不同参数之间用`&`隔开

* `req.url`中包含请求参数 使用`url `模块来获取参数

#### `url`模块用来处理请求路径

`url.parse(req.url,true)`解析,返回一个对象

* 第一个参数是要解析的`url`地址，第二个参数是是否将查询参数转换成对象
* 最后用`url.parse(req.url,true).query` 的到请求的数据对象

```javascript
 const http = require('http');
 // 导入url系统模块 用于处理url地址
 const url = require('url');
 const app = http.createServer();
 app.on('request', (req, res) => {
     // 将url路径的各个部分解析出来并返回对象
         // true 代表将参数解析为对象格式
     let {query} = url.parse(req.url, true);
     console.log(query);
 });
 app.listen(3000);
```



::: warning 注意

由于 `req.url `可能包含请求数据，不是纯粹的访问路径，所以不能直接用来作为请求地址判断的依据。

`pathname` 不包含数据，是存粹的请求地址，所以 用`pathname`来当作判断依据

`let { query ,pathname } = url.parse(req.url,ture)`

:::



### POST请求参数

* `post`参数没有存储在地址栏中
* 参数被放在请求体中（请求报中传输）
* 通过事件的方式接受
* 不是一次接受完，减轻服务器压力
* 当请求参数传递时触发`data`事件
* 当参数传递完成时触发`end`事件
* 在`req`上注册这两个事件的监听函数
* 使用`querystring`系统模块将参数转换为对象格式

```javascript
const http = require('http')
const url = require('url')
// 导入系统模块querystring 用于将POST请求的HTTP参数转换为对象格式
const querystring = require('querystring')

const app = http.createServer()


app.on('request', (req, res) => {

    let postParams = ''

    //由于POST请求数据并不是一次就发送完成，需要多次,每有数据发来时，就会触发data事件。
    req.on('data', pararms=>{
        postParams += pararms
    })
    //当数据传递完成后，触发end事件
    req.on('end',()=>{
        //调用querystring.parse(postParams) 将 postParams 字符串转换成对象
        let finalParams = querystring.parse(postParams)
        console.log(finalParams)
    })
    res.end('ok')
})

app.listen(3000)
```


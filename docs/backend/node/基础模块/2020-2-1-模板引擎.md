---
title: "art-template"
date: 2020-02-01
sidebar: 'auto'
categories:
- BackEnd
tags:
- node基础模块
---







# art-template

## 一、 简介

模板引擎是第三方模块。让开发者以更加友好的方式拼接字符串，使项目代码更加清晰、更加易于维护。art-template 是一个简约、超快的模板引擎。它采用作用域预声明的技术来优化模板渲染速度，从而获得接近 JavaScript 极限的运行性能，并且同时支持 NodeJS 和浏览器。使用art-template也便于维护代码，以前我们渲染数据是以模板字符串的形式在js文件中写入的html内容，如果html内容需要修改，我们需要在js中修改。而用了模板引擎以后，我们只需要html文件中修改html内容。还有使用了模板引擎以后DOM操作的效率也会更高一点。

**对比**

```javascript
// 未使用模板引擎的写法
var ary = [{ name: '张三', age: 20 }];
var str = '<ul>';
for (var i = 0; i < ary.length; i++) { 
    str += '<li>\
    <span>'+ ary[i].name +'</span>\
    <span>'+ ary[i].age +'</span>\
    </li>';
}
str += '</ul>'; 
```

```javascript
 <!-- 使用模板引擎的写法 --> 
 <ul>
    {{each ary}}
        <li>{{$value.name}}</li>
        <li>{{$value.age}}</li>
    {{/each}}
 </ul>
```

## 二、 使用

1. 在命令行工具中使用 `npm install art-template` 命令进行下载
2. 使用`const template = require('art-template')`引入模板引擎
3. 告诉模板引擎要拼接的数据和模板在哪 `const html = template(‘模板路径’, 数据)`
4. 使用模板语法告诉模板引擎，模板与数据应该如何进行拼接 

## 三、 语法

### 3.1 模板语法

art-template同时支持两种模板语法：标准语法和原始语法。
标准语法可以让模板更容易读写，原始语法具有强大的逻辑处理能力

### 3.2 输出

将某项数据输出在模板中，标准语法和原始语法如下：

```html
  <!-- 标准语法 -->
 <h2>{{value}}</h2>
 <h2>{{a ? b : c}}</h2>
 <h2>{{a + b}}</h2>

  <!-- 原始语法 -->
 <h2><%= value %></h2>
 <h2><%= a ? b : c %></h2>
 <h2><%= a + b %></h2>

```

**案例**

test.html

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    {{ name }}
    {{ age }}
</body>
</html>
```

app.js

```javascript
const tempalte = require('art-template')
const path = require('path')

let viewPath = path.join(__dirname, 'views', 'test.html')

let html = tempalte(viewPath, {
    name: '张三',
    age: '12'
})
console.log(html)

//输出结果
张三
12
```



### 3.3 输出原文

::: tip 注意
如果数据中携带HTML标签，默认模板引擎不会解析标签，会将其转义后输出。
使用该语法后数据中的html标签就会被解析成标签不会被转义。
:::

```html
标准语法：{{@ 数据 }}
原始语法：<%- 数据 %>
```

```html
 <!-- 标准语法 -->
 <h2>{{@ value }}</h2>
 <!-- 原始语法 -->
 <h2><%- value %></h2>
```

### 3.4 条件判断

**语法**

```html
<!-- 标准语法 -->
单分支
{{ if age > 10 }}
 <p>年龄大于10</p>
{{ /if }}

多分支
{{ if age > 10 }}
 年龄大于10
{{ else if age <= 10 && age > 3 }}
 年龄在3到10之间
{{ else }}
 年龄小于3
{{ /if }}


<!-- 原始语法 -->
 单分支
 <% if (age > 10) { %>
  年龄大于10
 <% } %>    

 多分支
 <% if (age > 10) { %>
  年龄大于10    
 <% } else if(age <=10 && age > 3) { %>
  年龄在3到10之间
 <% } else { %>
  年龄小于3
 <% } %>    
```

### 3.5 循环


标准语法：
``` html
{{each 数据}}{{/each}}其中{{$index}}表示元素的索引，{{$value}}表示元素的值
```
原始语法：
```html
<% for() { %> <% } %>
```


```html
 <!-- 标准语法 -->
 {{each target}}
     {{$index}} {{$value}}   
 {{/each}}


  <!-- 原始语法 -->
 <% for(var i = 0; i < target.length; i++){ %>
     <%= i %> <%= target[i] %>
 <% } %>
```

### 3.6 子模版

使用子模板可以将网站公共区块(头部、底部)抽离到单独的文件中。

```html
标准语法：{{include '模板路径'}}
原始语法：<%include('模板路径') %>
```

首先在views目录下建立一个common文件夹用来放置公共部分

```html
<!-- 标准语法 -->
{{include './common/header.html'}}
	<p>中间内容</p>
{{include './common/footer.html'}}

<!-- 原始语法 -->
<% include('./common/header.html') %>
	<p>中间内容</p>
<% include('./common/footer.html') %>
    
 
<!-- 结果 -->
<!-- 标准语法 -->
我是头部
<p>中间内容</p>
我是底部

<!-- 原始语法 -->
我是头部
<p>中间内容</p>
我是底部
```

### 3.7 模板继承

使用模板继承可以将网站HTML骨架抽离到单独的文件中，其他页面模板可以继承骨架文件。

<img src="https://my-blog-leo.oss-cn-chengdu.aliyuncs.com/21.png" alt="1.png"   />


在common文件夹中创建layout.html文件，作为html的骨架
供其他文件继承使用文件中有些部分用占位符留空，以供继承时填充。

```
{{block 'link'}}{{/block}} 和 {{block 'content'}} {{/block}}
```
就是填充符，本身不会显示在页面上。
第一个括号中的字符串就是该占位符的名称，通过这个可以在任何位置插入指定的内容。


<img src="https://i.loli.net/2020/02/01/choB7gNGqRPKsnZ.png"  />

`layou.html`文件（骨架文件）

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    {{block 'link'}}{{/block}}
</head>
<body>
    {{block 'content'}} {{/block}}
</body>
</html>
```

继承骨架的文件

```html
<!-- 继承骨架 -->
{{extend './common/layout.html'}} <!--表示继承自哪一个文件。-->

<!-- 为link占位符添加内容 -->
{{block 'link'}}
<link rel="stylesheet" href="./main.css">
{{/block}}

<!-- 为content占位符添加内容 -->
{{block 'content'}}
<p>{{ msg }}</p>
{{/block}}
```



### 3.8 模板配置

* 向模板中导入变量 `template.defaults.imports.变量名 = 变量值;`

> 导入的变量和函数，可以直接在页面中使用template语法使用导入的函数和变量

* 设置模板根目录 `template.defaults.root = 模板目录`

> 设置后，调用template方法时只需要传入文件名即可，template 引擎会自动拼接路径，得到模板文件路径。

* 设置模板默认后缀 `template.defaults.extname = '.art'`

> 设置后，调用template方法时，只需要传入文件名，不需要加后缀名，template就可以自动拼接后缀，并找到该文件

**案例**

```js
//设置模板根目录
template.defaults.root = path.join(__dirname, 'views')

//配置模板后缀
template.defaults.extname = '.html'

//导入模板变量，在模板文件中可以直接使用
template.defaults.imports.dateFormart = dateFormart

let html = template('07模板配置', {
    name: '张三',
    age: '6',
    time: new Date()
})
```

## 四、 express-art-template

### 4.1 配置

在`express`中使用`art-template`与普通的`art-template`的模板语法相同。只是配置方式不同。如下：

```js
//当后缀为HTML时用 express-art-template 引擎渲染
app.engine('html', require('express-art-template'))
//设置模板的根路径
app.set('views', path.join(__dirname, 'views'))
//设置要渲染的模板后缀为html
app.set('view engine', 'html')
```

### 4.2 使用

使用 `res.render ()` 方法渲染页面

```js
//在中间件函数中
module.exports = (req, res) => {
    res.render('test', {//渲染名为test的模板，并传入模板数据
        name: '昌',
        age: 12
    })
}
```


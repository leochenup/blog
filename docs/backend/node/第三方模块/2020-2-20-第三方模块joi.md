---
title: "ç¬¬ä¸‰æ–¹æ¨¡å—Joi"
date: 2020-02-20
sidebar: 'auto'
categories:
- BackEnd
tags:
- nodeç¬¬ä¸‰æ–¹æ¨¡å—
---









# ç¬¬ä¸‰æ–¹æ¨¡å— Joi

## æ¦‚è¿°

`joi` æ˜¯ `node.js` çš„ä¸€ä¸ªå·¥å…·æ¨¡å—ï¼Œä¸»è¦ç”¨äº `JavaScript` å¯¹è±¡çš„æ ¡éªŒã€‚å®ƒæ˜¯ä¸€ç§ç®€å•æ˜“ç”¨çš„ `javacript` å¯¹è±¡çº¦æŸæè¿°è¯­è¨€ï¼Œå¯ä»¥è½»æ¾è§£å†³ `nodejs` å¼€å‘ä¸­çš„å„ç§å‚æ•°çš„æ ¡éªŒã€‚

## éªŒè¯è§„åˆ™

`username`

```js
joi.string() // è§„å®šè¯¥å­—æ®µä¸ºå­—ç¬¦ç±»å‹
.required() // è¯¥å­—æ®µå¿…é¡»å¡«å†™
.min(3) // è¯¥å­—æ®µå­—ç¬¦ä¸²é•¿åº¦æœ€çŸ­ 3
.max(5) // è¯¥å­—æ®µå­—ç¬¦ä¸²æœ€é•¿é•¿åº¦ 5
.error(new Error('ç”¨æˆ·åä¸ç¬¦åˆè§„åˆ™')) // é”™è¯¯æç¤ºä¿¡æ¯è®¾ç½®ï¼Œä¸ç¬¦åˆéªŒè¯è§„åˆ™æ—¶ï¼ŒæŠ¥çš„ä¿¡æ¯ã€‚
```

`age`

```js
joi.number() // è§„å®šè¯¥å­—æ®µä¸ºæ•°å­—ç±»å‹
.required() // 
.min(18) // æœ€å°18 
.max(30) // æœ€å¤§ 30
```

`status`

```js
joi.number()
.valid(0, 1) // è¯¥å­—æ®µçš„å€¼å¿…é¡»ä¸º 0 æˆ– 1
.required()
.error(new Error('çŠ¶æ€ä¸ç¬¦åˆè§„åˆ™ï¼')),
```

`email`

```js
joi.string()
.required()
.email() // è¯¥å­—æ®µè¦æ»¡è¶³é‚®ç®±éªŒè¯è§„åˆ™
.error(new Error('é‚®ç®±æ ¼å¼ä¸ç¬¦åˆè¦æ±‚'))
```

`password`

```js
joi.string()
.regex(/^[a-zA-Z0-9]{3,30}$/) // è¯¥å­—æ®µè¦ç¬¦åˆè¯¥æ­£åˆ™è¡¨è¾¾å¼çš„éªŒè¯
.required()
.error(new Error('å¯†ç ä¸ç¬¦åˆè¦æ±‚'))
```

## ä½¿ç”¨

é¦–å…ˆå®šä¹‰ä»¥ä¸€ä¸ªéªŒè¯è§„åˆ™ `schema`ï¼Œç„¶åå†è°ƒç”¨ `joi.validate(obj, schema)` æ¥éªŒè¯ `obj` çš„å­—æ®µæ˜¯å¦ç¬¦åˆ `shema` çš„è¦æ±‚ã€‚

```js
const joi = require('joi')

//éªŒè¯å‡½æ•°
let validate = user => {
    //å®šä¹‰éªŒè¯è§„åˆ™
    let schema = {
        username: joi.string().required().min(3).max(5).error(new Error('ç”¨æˆ·åä¸ç¬¦åˆè§„åˆ™')),
        age: joi.number().required().min(18).max(30),
        status: joi.number().valid(0, 1).required().error(new Error('çŠ¶æ€ä¸ç¬¦åˆè§„åˆ™ï¼')),
        email: joi.string().required().email().error(new Error('é‚®ç®±æ ¼å¼ä¸ç¬¦åˆè¦æ±‚')),
        password: joi.string().regex(/^[a-zA-Z0-9]{3,30}$/).required().error(new Error('å¯†ç ä¸ç¬¦åˆè¦æ±‚')),
    }
    //è¿”å›éªŒè¯ç»“æœ  
    return joi.validate(user, schema)
}

//æ‰§è¡Œå‡½æ•°
let run = async () => {
    let user = {
        username: 'cyx',
        age: 22,
        status: 2,
        email: 'example@qq.com',
        password: 'zs123456'
    }

    try {
        await validate(user)
    } catch (error) {
        console.log(error.message)
    }
}

//æ‰§è¡Œ
run()
```

::: tip æ³¨æ„

`joi.validate` å‡½æ•°è¿”å›ä¸€ä¸ªç±» `promise` å¯¹è±¡ï¼Œå¯ä»¥å½“ä½œ `promise` å¤„ç†ã€‚

:::

[ğŸ‘‰æ›´å¤šå…³äºJoiæ¨¡å—](https://github.com/hapijs/joi)